# Backbone.Diorama.NestingView

A common pattern for Backbone applications is to nest views inside each
other. For example a collection index view where each model in the
collection gets a sub view. The advantage of this approach is that each
sub view can listen for and respond to events about a particular model,
removing the need for the collection view to be re-rendered.

Backbone.Diorama.NestingView makes it easy to stack views, as seen in
this example PostIndexView

```coffee
class Backbone.Views.PostIndexView extends Backbone.Diorama.NestingView
  template: Handlebars.templates['post_index.hbs']

  initialize: (options) ->
    @postCollection = options.postCollection # A Backbone.Collection
    @render()

  render: =>
    # Close any existing views
    @closeSubViews()
    # Render template, creating subviews with subView helper (see template below)
    @$el.html(@template(thisView: @, posts: @postCollection.models))
    # Render sub views into the elements created by subView helper in the template
    @renderSubViews()

    return @

  onClose: ->
    @closeSubViews()
```

```hbs
### post_index_view template ###
<h1>PostIndex</h1>
{{#each posts}}
  <!-- Create a PostRowView for each post, and add it to the template with subView -->
  {{addSubViewTo ../thisView "PostRowView" model=this}}
{{/each}}
```

## Handlebars helpers

#### {{ addSubViewTo nestingView childViewName hash=options }}
Call this helper to insert a sub view into a template at this point. Creates an
instance of the given childViewName, adds it to parentNestingView.subViews and
inserts a placeholder DOM element. The sub view won't be rendered into the
element until you call parentNestingView.renderSubViews()

* ```nestingView``` - The first argument is the parent nesting view object, typically the view whose template is being generated. If you used a generator to create your nesting view, this will be passed into the template as ```thisView```
* ```childViewName``` - The class name of the child view you want to insert. This will expect the view to be namespaced in Backbone.Views, e.g. given 'PostRowView', it create an instance of Backbone.View.PostRowView
* ```optionsHash``` - (optional) An options hash, which will be passed into the constructor for the view named by childViewName.

Example:

```hbs
  <!-- Add a new Backbone.Views.PostRowView for the post model into the current NestingView -->
  {{addSubViewTo thisView "PostRowView" model=post}} 
``` 

## Backbone.Diorama.NestingView methods

#### renderSubViews
For each view in ```@subViews```, it sets the DOM element of the view to the
placeholder rendered by the ```addSubViewTo``` handlebars helper, then calls
the render method. Call this after you've rendered the template for your
NestingView (NestingViews generated by ```diorama generate nestingView``` do
this by default).

#### closeSubViews
For each view in ```@subViews```, calls the ```onClose``` and ```close``` methods. Call this
before rendering your NestingView, and inside your NestingView's onClose method
(NestingViews generated by ```diorama generate nestingView``` do this by
default).

